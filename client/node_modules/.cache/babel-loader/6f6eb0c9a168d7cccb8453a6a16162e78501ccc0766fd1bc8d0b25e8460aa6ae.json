{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar iterall_1 = require(\"iterall\");\n/**\n * Given an AsyncIterable and a callback function, return an AsyncIterator\n * which produces values mapped via calling the callback function.\n */\nfunction mapAsyncIterator(iterator, callback, rejectCallback) {\n  var _a;\n  var $return;\n  var abruptClose;\n  if (typeof iterator.return === 'function') {\n    $return = iterator.return;\n    abruptClose = function (error) {\n      var rethrow = function () {\n        return Promise.reject(error);\n      };\n      return $return.call(iterator).then(rethrow, rethrow);\n    };\n  }\n  function mapResult(result) {\n    return result.done ? result : asyncMapValue(result.value, callback).then(iteratorResult, abruptClose);\n  }\n  var mapReject;\n  if (rejectCallback) {\n    // Capture rejectCallback to ensure it cannot be null.\n    var reject_1 = rejectCallback;\n    mapReject = function (error) {\n      return asyncMapValue(error, reject_1).then(iteratorResult, abruptClose);\n    };\n  }\n  return _a = {\n    next: function () {\n      return iterator.next().then(mapResult, mapReject);\n    },\n    return: function () {\n      return $return ? $return.call(iterator).then(mapResult, mapReject) : Promise.resolve({\n        value: undefined,\n        done: true\n      });\n    },\n    throw: function (error) {\n      if (typeof iterator.throw === 'function') {\n        return iterator.throw(error).then(mapResult, mapReject);\n      }\n      return Promise.reject(error).catch(abruptClose);\n    }\n  }, _a[iterall_1.$$asyncIterator] = function () {\n    return this;\n  }, _a;\n}\nexports.default = mapAsyncIterator;\nfunction asyncMapValue(value, callback) {\n  return new Promise(function (resolve) {\n    return resolve(callback(value));\n  });\n}\nfunction iteratorResult(value) {\n  return {\n    value: value,\n    done: false\n  };\n}","map":{"version":3,"names":["iterall_1","require","mapAsyncIterator","iterator","callback","rejectCallback","$return","abruptClose","return","error","rethrow","Promise","reject","call","then","mapResult","result","done","asyncMapValue","value","iteratorResult","mapReject","reject_1","_a","next","resolve","undefined","throw","catch","$$asyncIterator","exports","default"],"sources":["../../src/stitching/mapAsyncIterator.ts"],"sourcesContent":[null],"mappings":";;;AAAA,IAAAA,SAAA,GAAAC,OAAA;AAEA;;;;AAIA,SAAwBC,gBAAgBA,CACtCC,QAA0B,EAC1BC,QAAsC,EACtCC,cAAoB;;EAEpB,IAAIC,OAAY;EAChB,IAAIC,WAAgB;EAEpB,IAAI,OAAOJ,QAAQ,CAACK,MAAM,KAAK,UAAU,EAAE;IACzCF,OAAO,GAAGH,QAAQ,CAACK,MAAM;IACzBD,WAAW,GAAG,SAAAA,CAACE,KAAU;MACvB,IAAMC,OAAO,GAAG,SAAAA,CAAA;QAAM,OAAAC,OAAO,CAACC,MAAM,CAACH,KAAK,CAAC;MAArB,CAAqB;MAC3C,OAAOH,OAAO,CAACO,IAAI,CAACV,QAAQ,CAAC,CAACW,IAAI,CAACJ,OAAO,EAAEA,OAAO,CAAC;IACtD,CAAC;;EAGH,SAASK,SAASA,CAACC,MAAW;IAC5B,OAAOA,MAAM,CAACC,IAAI,GACdD,MAAM,GACNE,aAAa,CAACF,MAAM,CAACG,KAAK,EAAEf,QAAQ,CAAC,CAACU,IAAI,CAACM,cAAc,EAAEb,WAAW,CAAC;EAC7E;EAEA,IAAIc,SAAc;EAClB,IAAIhB,cAAc,EAAE;IAClB;IACA,IAAMiB,QAAM,GAAGjB,cAAc;IAC7BgB,SAAS,GAAG,SAAAA,CAACZ,KAAU;MACrB,OAAAS,aAAa,CAACT,KAAK,EAAEa,QAAM,CAAC,CAACR,IAAI,CAACM,cAAc,EAAEb,WAAW,CAAC;IAA9D,CAA8D;;EAGlE,OAAQgB,EAAA;IACNC,IAAI,WAAAA,CAAA;MACF,OAAOrB,QAAQ,CAACqB,IAAI,EAAE,CAACV,IAAI,CAACC,SAAS,EAAEM,SAAS,CAAC;IACnD,CAAC;IACDb,MAAM,WAAAA,CAAA;MACJ,OAAOF,OAAO,GACVA,OAAO,CAACO,IAAI,CAACV,QAAQ,CAAC,CAACW,IAAI,CAACC,SAAS,EAAEM,SAAS,CAAC,GACjDV,OAAO,CAACc,OAAO,CAAC;QAAEN,KAAK,EAAEO,SAAS;QAAET,IAAI,EAAE;MAAI,CAAE,CAAC;IACvD,CAAC;IACDU,KAAK,EAAL,SAAAA,CAAMlB,KAAU;MACd,IAAI,OAAON,QAAQ,CAACwB,KAAK,KAAK,UAAU,EAAE;QACxC,OAAOxB,QAAQ,CAACwB,KAAK,CAAClB,KAAK,CAAC,CAACK,IAAI,CAACC,SAAS,EAAEM,SAAS,CAAC;;MAEzD,OAAOV,OAAO,CAACC,MAAM,CAACH,KAAK,CAAC,CAACmB,KAAK,CAACrB,WAAW,CAAC;IACjD;KACAgB,EAAA,CAACvB,SAAA,CAAA6B,eAAe,IAAhB;IACE,OAAO,IAAI;EACb,CAAC,E,EACM;AACX;AAjDAC,OAAA,CAAAC,OAAA,GAAA7B,gBAAA;AAmDA,SAASgB,aAAaA,CACpBC,KAAQ,EACRf,QAAsC;EAEtC,OAAO,IAAIO,OAAO,CAAC,UAAAc,OAAO;IAAI,OAAAA,OAAO,CAACrB,QAAQ,CAACe,KAAK,CAAC,CAAC;EAAxB,CAAwB,CAAC;AACzD;AAEA,SAASC,cAAcA,CAAID,KAAQ;EACjC,OAAO;IAAEA,KAAK,EAAAA,KAAA;IAAEF,IAAI,EAAE;EAAK,CAAE;AAC/B"},"metadata":{},"sourceType":"script","externalDependencies":[]}