{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar graphql_1 = require(\"graphql\");\nvar error_1 = require(\"graphql/error\");\nvar getResponseKeyFromInfo_1 = require(\"./getResponseKeyFromInfo\");\nif (typeof global !== 'undefined' && 'Symbol' in global || typeof window !== 'undefined' && 'Symbol' in window) {\n  exports.ERROR_SYMBOL = Symbol('subSchemaErrors');\n} else {\n  exports.ERROR_SYMBOL = '@@__subSchemaErrors';\n}\nfunction annotateWithChildrenErrors(object, childrenErrors) {\n  var _a;\n  if (!childrenErrors || childrenErrors.length === 0) {\n    // Nothing to see here, move along\n    return object;\n  }\n  if (Array.isArray(object)) {\n    var byIndex_1 = {};\n    childrenErrors.forEach(function (error) {\n      if (!error.path) {\n        return;\n      }\n      var index = error.path[1];\n      var current = byIndex_1[index] || [];\n      current.push(__assign(__assign({}, error), {\n        path: error.path.slice(1)\n      }));\n      byIndex_1[index] = current;\n    });\n    return object.map(function (item, index) {\n      return annotateWithChildrenErrors(item, byIndex_1[index]);\n    });\n  }\n  return __assign(__assign({}, object), (_a = {}, _a[exports.ERROR_SYMBOL] = childrenErrors.map(function (error) {\n    return __assign(__assign({}, error), error.path ? {\n      path: error.path.slice(1)\n    } : {});\n  }), _a));\n}\nexports.annotateWithChildrenErrors = annotateWithChildrenErrors;\nfunction getErrorsFromParent(object, fieldName) {\n  var errors = object && object[exports.ERROR_SYMBOL] || [];\n  var childrenErrors = [];\n  for (var _i = 0, errors_1 = errors; _i < errors_1.length; _i++) {\n    var error = errors_1[_i];\n    if (!error.path || error.path.length === 1 && error.path[0] === fieldName) {\n      return {\n        kind: 'OWN',\n        error: error\n      };\n    } else if (error.path[0] === fieldName) {\n      childrenErrors.push(error);\n    }\n  }\n  return {\n    kind: 'CHILDREN',\n    errors: childrenErrors\n  };\n}\nexports.getErrorsFromParent = getErrorsFromParent;\nvar CombinedError = /** @class */function (_super) {\n  __extends(CombinedError, _super);\n  function CombinedError(message, errors) {\n    var _this = _super.call(this, message) || this;\n    _this.errors = errors;\n    return _this;\n  }\n  return CombinedError;\n}(Error);\nfunction checkResultAndHandleErrors(result, info, responseKey) {\n  if (!responseKey) {\n    responseKey = getResponseKeyFromInfo_1.getResponseKeyFromInfo(info);\n  }\n  if (result.errors && (!result.data || result.data[responseKey] == null)) {\n    // apollo-link-http & http-link-dataloader need the\n    // result property to be passed through for better error handling.\n    // If there is only one error, which contains a result property, pass the error through\n    var newError = result.errors.length === 1 && hasResult(result.errors[0]) ? result.errors[0] : new CombinedError(concatErrors(result.errors), result.errors);\n    throw error_1.locatedError(newError, info.fieldNodes, graphql_1.responsePathAsArray(info.path));\n  }\n  var resultObject = result.data[responseKey];\n  if (result.errors) {\n    resultObject = annotateWithChildrenErrors(resultObject, result.errors);\n  }\n  return resultObject;\n}\nexports.checkResultAndHandleErrors = checkResultAndHandleErrors;\nfunction concatErrors(errors) {\n  return errors.map(function (error) {\n    return error.message;\n  }).join('\\n');\n}\nfunction hasResult(error) {\n  return error.result || error.extensions || error.originalError && error.originalError.result;\n}","map":{"version":3,"names":["graphql_1","require","error_1","getResponseKeyFromInfo_1","global","window","exports","ERROR_SYMBOL","Symbol","annotateWithChildrenErrors","object","childrenErrors","length","Array","isArray","byIndex_1","forEach","error","path","index","current","push","__assign","slice","map","item","_a","getErrorsFromParent","fieldName","errors","_i","errors_1","kind","CombinedError","_super","__extends","message","_this","call","Error","checkResultAndHandleErrors","result","info","responseKey","getResponseKeyFromInfo","data","newError","hasResult","concatErrors","locatedError","fieldNodes","responsePathAsArray","resultObject","join","extensions","originalError"],"sources":["../../src/stitching/errors.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}